FROM ubuntu:22.04

RUN apt-get update && apt-get install -y curl ca-certificates bash nginx && rm -rf /var/lib/apt/lists/*

# Install Solana toolchain in a deterministic path.
RUN sh -c "$(curl -sSfL https://release.solana.com/stable/install)" && \
    ln -sf /root/.local/share/solana/install/active_release/bin/solana /usr/local/bin/solana && \
    ln -sf /root/.local/share/solana/install/active_release/bin/solana-test-validator /usr/local/bin/solana-test-validator

RUN mkdir -p /var/lib/solana/ledger

COPY nginx.conf /etc/nginx/nginx.conf
COPY entrypoint.sh /usr/local/bin/start-solana.sh
RUN chmod +x /usr/local/bin/start-solana.sh

EXPOSE 8080

CMD ["/usr/local/bin/start-solana.sh"]
